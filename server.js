const http=require('http');const https=require('https');const fs=require('fs');const path=require('path');const{URL}=require('url');const PORT=process.env.PORT||3000;const server=http.createServer((req,res)=>{const fullUrl=new URL(req.url,`http://${req.headers.host}`);const targetUrl=fullUrl.searchParams.get('url');if(targetUrl){let target;try{target=new URL(targetUrl);}catch(err){res.writeHead(400,{'Content-Type':'text/plain'});res.end('Invalid target URL');return;}const client=target.protocol==='https:'?https:http;const options={headers:{'User-Agent':req.headers['user-agent']||'GooProxy/1.0 UV','Accept-Encoding':'identity'}};client.get(target.toString(),options,(proxyRes)=>{const contentType=proxyRes.headers['content-type']||'';if(contentType.includes('text/html')){let body='';proxyRes.setEncoding('utf8');proxyRes.on('data',chunk=>body+=chunk);proxyRes.on('end',()=>{const rewritten=rewriteHtml(body,target);res.writeHead(proxyRes.statusCode,{'Content-Type':contentType});res.end(rewritten);});}else{res.writeHead(proxyRes.statusCode,proxyRes.headers);proxyRes.pipe(res);}}).on('error',err=>{res.writeHead(500,{'Content-Type':'text/plain'});res.end('Error fetching target URL: '+err.message);});}else{const uiPath=path.join(__dirname,'index.html');fs.readFile(uiPath,(err,data)=>{if(err){res.writeHead(404,{'Content-Type':'text/plain'});res.end('404 Not Found');}else{res.writeHead(200,{'Content-Type':'text/html'});res.end(data);}});} });server.listen(PORT,()=>{console.log('GooProxy UV running on port '+PORT);});function rewriteHtml(html,baseUrl){return html.replace(/(href|src)=["']([^"']+)["']/gi,(match,attr,link)=>{if(link.startsWith('javascript:')||link.startsWith('mailto:')||link.startsWith('#'))return match;if(link.startsWith('//'))link=baseUrl.protocol+link;let absoluteUrl;try{absoluteUrl=new URL(link,baseUrl).toString();}catch(e){return match;}return `${attr}="/?url=${encodeURIComponent(absoluteUrl)}"`;});}
